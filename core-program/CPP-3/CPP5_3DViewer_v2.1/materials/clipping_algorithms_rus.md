# Основные подходы к удалению невидимых поверхностей

## Z-буфер

Алгоритм Z-буфера - простой и интуитивно понятный алгоритм удаления невидимых поверхностей. Он основан на двух особых структурах данных - буфер кадра и Z-буфер. Z-буфер представляет из себя матрицу пикселей экрана, каждый элемент которого содержит ближайшую к наблюдателю координату (в системе координат наблюдателя) глубины некоторой поверхности сцены (ось глубины в системе координат наблюдателя конвенционально считается ось Z). Буфер кадра - матрица пикселей с их интенсивностями. Вначале весь буфер заполнен максимальным значением глубины, затем для каждого полигона сцены находятся те пиксели, для которых координата Z оказалась меньшей чем буферезированное значение соответствующих пикселей, и это значение заносится в Z-буфер, а соотвествующее значение интенсивности заносится в буфер кадра.

Формальное описание алгоритма Z-буфера таково:

- Заполнить буфер кадра фоновым значением интенсивности или цвета.

- Заполнить Z-буфер максимальным значением `z`.

- Преобразовать каждый полигон в растровую форму в произвольном порядке (растеризация).

- Для каждого пикселя в полигоне вычислить его глубину `z`.

- Сравнить глубину `z` со значением в буфере `z0`, хранящимся в Z-буфере в этой же позиции.

- Если `z > z0`, то записать атрибут этого многоугольника (интенсивность, цвет и т. п.) в буфер кадра и заменить значение в буфере на `z`. В противном случае никаких действий не производить.

## Ray casting

Алгоритм Ray casting - алгоритм удаления невидимых поверхностей, основанный на выпускании лучей по всей области видимости наблюдателя. Полигоны проецируются на экран наблюдателя и растеризируются. Для каждого пикселя экрана испускается луч, и фиксируется первое пересечение с какими-либо объектом. Этот объект является видимым для этого пикселя. Значение интенсивности для этого пикселя может быть вычислено при растеризации объекта как в алгоритме с Z-буфером, или же может быть получено трассировкой луча далее с учетом его последующих отражений и преломлений к источнику света (тогда Ray casting превращается в Ray tracing). Ray tracing является несколько более сложным подходом, но дает более реалистичный результат.

Формальное описание алгоритма Ray casting:

- Преобразовать каждый полигон в растровую форму в произвольном порядке (растеризация).

- Выпустить пучок лучей для каждого пикселя экрана.

- Для каждого луча найти пересечение с полигоном, находящееся наиболее близко к наблюдателю.

- Вычислить интенсивность и заполнить соответствующий пиксель изображения.
